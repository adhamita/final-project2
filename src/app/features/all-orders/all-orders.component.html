<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
    <div class="mb-4 md:mb-0">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">Order History</h1>
      <p class="text-gray-600">Track and manage your orders</p>
    </div>
    <button 
      (click)="refreshOrders()"
      class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-300">
      <i class="fas fa-sync-alt"></i>
      <span>Refresh Orders</span>
    </button>
  </div>

  <div class="flex flex-wrap gap-2 mb-6 border-b border-gray-200">
    <button 
      (click)="filterOrders('all')"
      [class]="selectedFilter === 'all' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
      class="px-4 py-2 border-b-2 font-medium text-sm transition-colors duration-300">
      All Orders ({{orders.length}})
    </button>
    <button 
      (click)="filterOrders('paid')"
      [class]="selectedFilter === 'paid' ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
      class="px-4 py-2 border-b-2 font-medium text-sm transition-colors duration-300">
      Paid Orders
    </button>
    <button 
      (click)="filterOrders('delivered')"
      [class]="selectedFilter === 'delivered' ? 'border-green-500 text-green-600 bg-green-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
      class="px-4 py-2 border-b-2 font-medium text-sm transition-colors duration-300">
      Delivered
    </button>
    <button 
      (click)="filterOrders('pending')"
      [class]="selectedFilter === 'pending' ? 'border-yellow-500 text-yellow-600 bg-yellow-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
      class="px-4 py-2 border-b-2 font-medium text-sm transition-colors duration-300">
      Pending
    </button>
    <button 
      (click)="filterOrders('recent')"
      [class]="selectedFilter === 'recent' ? 'border-purple-500 text-purple-600 bg-purple-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
      class="px-4 py-2 border-b-2 font-medium text-sm transition-colors duration-300">
      Recent (30 days)
    </button>
  </div>

  @if (isLoading) {
    <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-2">
      @for (item of [1,2,3,4]; track item) {
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden animate-pulse">
          <div class="p-6">
            <div class="flex justify-between items-start mb-4">
              <div class="h-6 bg-gray-300 rounded w-32"></div>
              <div class="h-6 bg-gray-300 rounded w-20"></div>
            </div>
            <div class="h-4 bg-gray-300 rounded w-24 mb-4"></div>
            <div class="space-y-3">
              <div class="h-4 bg-gray-300 rounded w-full"></div>
              <div class="h-4 bg-gray-300 rounded w-3/4"></div>
              <div class="h-4 bg-gray-300 rounded w-1/2"></div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <div class="h-8 bg-gray-300 rounded w-24"></div>
              <div class="h-6 bg-gray-300 rounded w-16"></div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  @else if (filteredOrders.length > 0) {
    <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-2">
      @for (order of filteredOrders; track order._id) {
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 overflow-hidden group">
          <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2">
              <div>
                <h3 class="font-bold text-gray-800 text-lg">Order #{{order.id}}</h3>
                <p class="text-sm text-gray-600">{{order.createdAt | date:'medium'}}</p>
              </div>
              <span [class]="getOrderStatusClass(order)" 
                    class="px-3 py-1 rounded-full text-sm font-medium">
                {{getOrderStatus(order)}}
              </span>
            </div>
          </div>

          <div class="p-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
              <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                <i [class]="getPaymentMethodIcon(order.paymentMethodType)" 
                   class="text-blue-600 text-xl"></i>
                <div>
                  <p class="text-sm text-gray-600">Payment Method</p>
                  <p class="font-semibold text-gray-800 capitalize">{{order.paymentMethodType}}</p>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                <div>
                  <p class="text-sm text-gray-600">Total Amount</p>
                  <p class="font-bold text-gray-800">{{order.totalOrderPrice | currency:'USD':'symbol':'1.2-2'}}</p>
                </div>
              </div>
            </div>

            @if (order.shippingAddress) {
              <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                <h4 class="font-semibold text-gray-800 mb-2 flex items-center gap-2">
                  <i class="fas fa-map-marker-alt text-blue-600"></i>
                  Shipping Address
                </h4>
                <div class="text-sm text-gray-700 space-y-1">
                  <p><span class="font-medium">{{order.shippingAddress.details}}</span></p>
                  <p>{{order.shippingAddress.city}}, {{order.shippingAddress.phone}}</p>
                </div>
              </div>
            }

            <div class="mb-6">
              <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <i class="fas fa-shopping-cart text-purple-600"></i>
                Items ({{getTotalItems(order)}} items)
              </h4>
              <div class="space-y-3 max-h-40 overflow-y-auto">
                @for (item of order.cartItems; track item._id) {
                  <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 group cursor-pointer"
                       (click)="viewProductDetails(item.product._id, item.product.title)">
                    <img [src]="item.product.imageCover" 
                         [alt]="item.product.title"
                         class="w-12 h-12 object-cover rounded-lg group-hover:ring-2 group-hover:ring-green-300 transition-all duration-200">
                    <div class="flex-1 min-w-0">
                      <p class="font-medium text-gray-800 truncate group-hover:text-green-600 transition-colors duration-200">
                        {{item.product.title}}
                      </p>
                      <div class="flex items-center gap-4 text-sm text-gray-600">
                        <span>Qty: {{item.count}}</span>
                        <span class="font-semibold">{{item.price | currency:'USD':'symbol':'1.2-2'}}</span>
                      </div>
                    </div>
                    <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                      <i class="fas fa-external-link-alt text-green-600"></i>
                    </div>
                  </div>
                }
              </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-4 border-t border-gray-200">
              <div class="text-center sm:text-left">
                <p class="text-sm text-gray-600">Order Total</p>
                <p class="text-2xl font-bold text-green-600">{{order.totalOrderPrice | currency:'USD':'symbol':'1.2-2'}}</p>
              </div>
              <div class="flex gap-2">
                @if (!order.isPaid) {
                  <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                    <i class="fas fa-credit-card mr-2"></i>
                    Pay Now
                  </button>
                }
                <button 
                  (click)="viewOrderDetails(order)"
                  class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-300">
                  <i class="fas fa-shopping-bag mr-2"></i>
                  View Product
                </button>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <div class="mt-8 bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl border border-green-200">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div>
          <p class="text-2xl font-bold text-gray-800">{{orders.length}}</p>
          <p class="text-sm text-gray-600">Total Orders</p>
        </div>
        <div>
          <p class="text-2xl font-bold text-blue-600">{{getPaidOrdersCount()}}</p>
          <p class="text-sm text-gray-600">Paid Orders</p>
        </div>
        <div>
          <p class="text-2xl font-bold text-green-600">{{getDeliveredOrdersCount()}}</p>
          <p class="text-sm text-gray-600">Delivered</p>
        </div>
        <div>
          <p class="text-2xl font-bold text-yellow-600">{{getPendingOrdersCount()}}</p>
          <p class="text-sm text-gray-600">Pending</p>
        </div>
      </div>
    </div>
  }

  @else {
    <div class="text-center py-16">
      <div class="max-w-md mx-auto">
        <div class="mb-6">
          <i class="fas fa-shopping-bag text-6xl text-gray-300"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">
          @switch (selectedFilter) {
            @case ('paid') {
              No paid orders found
            }
            @case ('delivered') {
              No delivered orders found
            }
            @case ('pending') {
              No pending orders found
            }
            @case ('recent') {
              No recent orders found
            }
            @default {
              No orders found
            }
          }
        </h3>
        <p class="text-gray-600 mb-6">
          @if (selectedFilter === 'all') {
            You haven't placed any orders yet. Start shopping to see your order history here.
          } @else {
            Try selecting a different filter to view other orders.
          }
        </p>
        @if (selectedFilter === 'all') {
          <button class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors duration-300">
            <i class="fas fa-shopping-cart mr-2"></i>
            Start Shopping
          </button>
        }
      </div>
    </div>
  }
</div>